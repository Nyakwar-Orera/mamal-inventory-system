{% extends "layouts/base.html" %}

{% block title %}Set New Password - MAMAL Lab{% endblock %}

{% block styles %}
<style>
  body {
    background: url('{{ url_for('static', filename='images/bg-login.jpg') }}') no-repeat center center fixed;
    background-size: cover;
  }
  #strengthMessage {
    font-size: 0.9rem;
  }
</style>
{% endblock %}

{% block scripts %}
<script>
  const passwordInput = document.getElementById('password');
  const strengthMessage = document.getElementById('strengthMessage');

  if (passwordInput && strengthMessage) {
    passwordInput.addEventListener('input', () => {
      const val = passwordInput.value;
      let strength = 'Weak';
      let color = 'red';

      if (val.length >= 8 && /[A-Z]/.test(val) && /[0-9]/.test(val) && /[^A-Za-z0-9]/.test(val)) {
        strength = 'Strong';
        color = 'green';
      } else if (val.length >= 6) {
        strength = 'Moderate';
        color = 'orange';
      }

      strengthMessage.textContent = `Password strength: ${strength}`;
      strengthMessage.style.color = color;
    });
  }
</script>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center vh-100">
  <div class="col-md-6 col-lg-4">
    <div class="card shadow-lg">
      <div class="card-body">

        <!-- Logo (Optional) -->
        <div class="text-center mb-3">
          <img src="{{ url_for('static', filename='images/logo.png') }}" alt="MAMAL Lab Logo" height="60">
        </div>

        <h4 class="text-center mb-2">üîê Reset Your Password</h4>
        <p class="text-center text-muted">Choose a strong password to keep your account secure.</p>

        <form method="POST" action="{{ url_for('auth.reset_password', token=token) }}">
          {{ form.hidden_tag() }}

          <div class="form-group mb-3">
            {{ form.password.label(class="form-label", id="passwordLabel") }}
            {{ form.password(class="form-control", placeholder="New password", id="password", aria_labelledby="passwordLabel") }}
            <small id="strengthMessage" class="form-text"></small>
            {% for error in form.password.errors %}
              <div class="text-danger small mt-1">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="form-group mb-4">
            {{ form.password2.label(class="form-label") }}
            {{ form.password2(class="form-control", placeholder="Repeat new password") }}
            {% for error in form.password2.errors %}
              <div class="text-danger small mt-1">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="d-grid mb-2">
            {{ form.submit(class="btn btn-success") }}
          </div>

          <div class="text-center">
            <a href="{{ url_for('auth.login') }}" class="text-decoration-none small">‚Üê Back to login</a>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}
