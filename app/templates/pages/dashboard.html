{% extends "layouts/base.html" %}

{% block title %}Dashboard - MAMAL Inventory System{% endblock %}

{% block content %}
<style>
  .card-title i {
    margin-right: 8px;
  }
  .card-body .display-6 {
    font-size: 2.2rem;
    font-weight: 600;
  }
  .card {
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
  }
  .card-header {
    background-color: #f8f9fa;
    font-weight: 600;
  }
</style>

<div class="container-fluid px-4">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <div>
      <h1 class="h2 fw-bold text-primary">Dashboard</h1>
    </div>
  </div>

  <!-- üî¢ Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-white bg-primary">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-laptop"></i>Total Assets</h5>
          <p class="display-6">{{ total_assets }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-success">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-check-circle"></i>Available</h5>
          <p class="display-6">{{ status_counts['Available'] }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-warning">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-people"></i>Checked Out</h5>
          <p class="display-6">{{ active_checkouts }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-danger">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-exclamation-triangle"></i>Under Maintenance</h5>
          <p class="display-6">{{ status_counts['Maintenance'] }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- üìä Charts Section -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header text-primary">üìà Asset by Type</div>
        <div class="card-body">
          <canvas id="assetChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header text-success">üè¢ Asset by Location</div>
        <div class="card-body">
          <canvas id="locationChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- üîî Low Stock / Pending Maintenance Section -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header text-warning">‚ö†Ô∏è Low Stock Items</div>
        <div class="card-body">
          {% if low_stock %}
            <ul class="list-group">
              {% for item in low_stock %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ item.item_type }} ({{ item.location or 'N/A' }})
                  <span class="badge bg-warning text-dark">Qty: {{ item.quantity }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No low stock alerts.</p>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header text-danger">üõ†Ô∏è Pending Maintenance</div>
        <div class="card-body">
          {% if pending_maintenance > 0 %}
            <p class="text-danger fw-bold">{{ pending_maintenance }} asset(s) need maintenance.</p>
          {% else %}
            <p class="text-muted">All assets are in good condition.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üìä Chart Script -->
<script>
  const assetCtx = document.getElementById('assetChart');
  new Chart(assetCtx, {
    type: 'bar',
    data: {{ asset_chart_data | safe }},
    options: {
      responsive: true,
      plugins: { legend: { display: false } }
    }
  });

  const locationCtx = document.getElementById('locationChart');
  new Chart(locationCtx, {
    type: 'pie',
    data: {{ location_chart_data | safe }},
    options: { responsive: true }
  });
</script>
{% endblock %}
